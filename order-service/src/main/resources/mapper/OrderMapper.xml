<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.orderservice.dao.OrderMapper" >
    <resultMap id="OrderDetailMap" type="com.example.orderservice.vo.OrderDetailVo">
        <id property="order_id" column="order_id"/>
        <association property="comment" column="order_id" javaType="com.example.orderservice.pojo.Comment" select="findCommentById"/>
    </resultMap>
    <select id="findAllDetail" resultMap="OrderDetailMap">
        select * from soadb.order natural join soadb.comment;
    </select>
    <select id="findCommentById" resultType="com.example.orderservice.pojo.Comment">
        select * from soadb.comment where order_id = #{order_id};
    </select>
    <update id="takeOrder" parameterType="java.lang.String">
        UPDATE soadb.order SET state=1,driver_id=#{driver_id} WHERE order_id = #{order_id};
    </update>
    <update id="pickUp">
        UPDATE soadb.order SET state=2 WHERE order_id = #{order_id};
    </update>
    <update id="finishOrder">
        UPDATE soadb.order SET state=3 WHERE order_id = #{order_id};
    </update>
    <insert id="saveComment">
        INSERT INTO soadb.comment VALUES (#{order_id},#{score},#{content});
    </insert>
</mapper>